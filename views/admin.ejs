<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Paneli | Araç Galerisi</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/admin.css">
</head>

<body>
    <header>
        <div class="header-content">
            <div class="logo">Araç<span>Galeri</span> Admin</div>
            <nav class="admin-nav">
                <a href="/"><i class="fas fa-home"></i> Ana Sayfa</a>
                <a href="/admin/add-car"><i class="fas fa-plus-circle"></i> Yeni Araç</a>
                <a href="/"><i class="fas fa-car"></i> Siteyi Görüntüle</a>
                <a href="/logout"><i class="fas fa-sign-out-alt"></i> Çıkış</a>
            </nav>
        </div>
    </header>

    <div class="container">
        <div id="notification" class="alert" style="display: none;"></div>

        <h1><i class="fas fa-car"></i> Yeni Araç Ekle</h1>

        <div class="form-container">
            <form action="/admin/add-car" method="POST" enctype="multipart/form-data" id="carForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="title"><i class="fas fa-heading"></i> Başlık</label>
                        <input type="text" id="title" name="title" placeholder="Örnek: 2021 BMW 320i Sport Line"
                            required>
                    </div>

                    <div class="form-group">
                        <label for="brand"><i class="fas fa-tag"></i> Marka</label>
                        <input type="text" id="brand" name="brand" placeholder="Örnek: BMW" required>
                    </div>

                    <div class="form-group">
                        <label for="model"><i class="fas fa-car-side"></i> Model</label>
                        <input type="text" id="model" name="model" placeholder="Örnek: 320i" required>
                    </div>

                    <div class="form-group">
                        <label for="year"><i class="fas fa-calendar-alt"></i> Yıl</label>
                        <input type="number" id="year" name="year" min="1900" max="2099" placeholder="Örnek: 2021"
                            required>
                    </div>

                    <div class="form-group">
                        <label for="fuelType"><i class="fas fa-gas-pump"></i> Yakıt Türü</label>
                        <select id="fuelType" name="fuelType" required>
                            <option value="">Seçiniz</option>
                            <option value="Benzin">Benzin</option>
                            <option value="Dizel">Dizel</option>
                            <option value="Hybrid">Hybrid</option>
                            <option value="Elektrik">Elektrik</option>
                            <option value="LPG">LPG</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="price"><i class="fas fa-tag"></i> Fiyat (₺)</label>
                        <input type="number" id="price" name="price" placeholder="Örnek: 1250000" required>
                    </div>

                    <div class="form-group">
                        <label for="gear"><i class="fas fa-cogs"></i> Vites</label>
                        <select id="gear" name="gear" required>
                            <option value="">Seçiniz</option>
                            <option value="Otomatik">Otomatik</option>
                            <option value="Manuel">Manuel</option>
                            <option value="Yarı Otomatik">Yarı Otomatik</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="km"><i class="fas fa-tachometer-alt"></i> Kilometre</label>
                        <input type="number" id="km" name="km" placeholder="Örnek: 45000" required>
                    </div>

                    <div class="form-group">
                        <label for="color"><i class="fas fa-palette"></i> Renk</label>
                        <input type="text" id="color" name="color" placeholder="Örnek: Beyaz" required>
                    </div>

                    <div class="form-group">
                        <label for="horsePower"><i class="fas fa-horse-head"></i> Beygir Gücü</label>
                        <input type="number" id="horsePower" name="horsePower" placeholder="Örnek: 184" required>
                    </div>

                    <div class="form-group">
                        <label for="engine"><i class="fas fa-oil-can"></i> Motor Hacmi (cc)</label>
                        <input type="number" id="engine" name="engine" placeholder="Örnek: 1998" required>
                    </div>

                    <div class="form-group">
                        <label for="caseType"><i class="fas fa-car-side"></i> Kasa Tipi</label>
                        <select id="caseType" name="caseType" required>
                            <option value="">Seçiniz</option>
                            <option value="Sedan">Sedan</option>
                            <option value="Hatchback">Hatchback</option>
                            <option value="SUV">SUV</option>
                            <option value="Coupe">Coupe</option>
                            <option value="Cabrio">Cabrio</option>
                            <option value="Station Wagon">Station Wagon</option>
                            <option value="Pickup">Pickup</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="packet"><i class="fas fa-box-open"></i> Paket</label>
                        <input type="text" id="packet" name="packet" placeholder="Örnek: Sport Line" required>
                    </div>

                    <div class="form-group">
                        <label for="plate"><i class="fas fa-id-card"></i> Plaka</label>
                        <input type="text" id="plate" name="plate" placeholder="Örnek: 34 ABC 123" required>
                    </div>

                    <div class="form-group">
                        <label for="damage"><i class="fas fa-car-crash"></i> Hasar Durumu (0-5)</label>
                        <input type="number" id="damage" name="damage" min="0" max="5"
                            placeholder="0: Hasar yok, 5: Ağır hasarlı" required>
                    </div>

                    <div class="form-group">
                        <label for="adverdNumber"><i class="fas fa-hashtag"></i> İlan Numarası</label>
                        <input type="number" id="adverdNumber" name="adverdNumber" placeholder="Örnek: 123456" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="image-upload">
                        <i class="fas fa-cloud-upload-alt fa-2x"></i>
                        Fotoğrafları sürükleyip bırakın veya tıklayarak seçin
                    </label>
                    <input type="file" id="image-upload" name="image" accept="image/*" multiple required>
                    <p>Maksimum 5 fotoğraf yükleyebilirsiniz. (JPEG, PNG)</p>

                </div>

                <div class="form-group">
                    <label for="description"><i class="fas fa-align-left"></i> Açıklama</label>
                    <textarea id="description" name="description"
                        placeholder="Aracın detaylı açıklamasını buraya yazın..." required></textarea>
                </div>

                <div class="form-group">
                    <button type="submit" class="btn btn-success btn-block"><i class="fas fa-save"></i> Araç
                        Ekle</button>
                </div>
            </form>
        </div>

        <section class="car-list">
            <h2><i class="fas fa-list"></i> Mevcut Araçlar</h2>

            <% if (cars.length===0) { %>
                <div class="alert"
                    style="display: block; background-color: var(--light-color); color: var(--dark-color);">
                    <i class="fas fa-info-circle"></i> Henüz hiç araç eklenmemiş.
                </div>
                <% } else { %>
                    <div class="car-container">
                        <% cars.forEach(car=> { %>
                            <div class="car">
                                <div class="slider-container">
                                    <div class="slider" id="slider-<%= car._id %>">
                                        <% car.image.forEach(image=> { %>
                                            <div class="slide">
                                                <img src="<%= image %>" alt="<%= car.title %>">
                                            </div>
                                            <% }) %>
                                    </div>
                                    <div class="controls">
                                        <i class="fa-solid fa-angle-left fa-xl prev-btn"
                                            data-target="slider-<%= car._id %>"></i>
                                        <i class="fa-solid fa-angle-right fa-xl next-btn"
                                            data-target="slider-<%= car._id %>"></i>
                                    </div>
                                </div>

                                <div class="car-info">
                                    <h3 class="car-title">
                                        <%= car.brand %>
                                            <%= car.model %>
                                                <%= car.year %>
                                    </h3>
                                    <p class="price">₺<%= car.price.toLocaleString('tr-TR') %>
                                    </p>

                                    <div class="car-details">
                                        <span class="detail-item"><i class="fas fa-tachometer-alt"></i>
                                            <%= car.km.toLocaleString('tr-TR') %> km
                                        </span>
                                        <span class="detail-item"><i class="fas fa-gas-pump"></i>
                                            <%= car.fuelType %>
                                        </span>
                                        <span class="detail-item"><i class="fas fa-cogs"></i>
                                            <%= car.gear %>
                                        </span>
                                        <span class="detail-item"><i class="fas fa-palette"></i>
                                            <%= car.color %>
                                        </span>
                                    </div>

                                    <div class="car-actions">
                                        <a href="/cars/<%= car._id %>" class="btn"><i class="fas fa-eye"></i>
                                            Görüntüle</a>
                                        <a class="btn btn-danger del" data-doc="<%= car._id %>"><i
                                                class="fas fa-trash"></i> Sil</a>
                                    </div>
                                </div>
                            </div>
                            <% }) %>
                    </div>
                    <% } %>
        </section>
    </div>

    <script>
        // Slider fonksiyonları
document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll('.prev-btn, .next-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const sliderId = this.getAttribute('data-target');
            const slider = document.getElementById(sliderId);
            const slides = slider.querySelectorAll('.slide');
            let currentIndex = parseInt(slider.getAttribute('data-index') || 0);
            
            if (this.classList.contains('prev-btn')) {
                currentIndex = (currentIndex - 1 + slides.length) % slides.length;
            } else {
                currentIndex = (currentIndex + 1) % slides.length;
            }
            
            slider.style.transform = `translateX(-${currentIndex * 100}%)`;
            slider.setAttribute('data-index', currentIndex);
        });
    });
});
        // Silme işlemi
        document.querySelectorAll('a.del').forEach(button => {
            button.addEventListener('click', async (e) => {
                e.preventDefault();

                if (!confirm('Bu aracı silmek istediğinize emin misiniz? Bu işlem geri alınamaz.')) {
                    return;
                }

                const buttonElement = e.target.closest('.del');
                if (!buttonElement) return;

                const docId = buttonElement.dataset.doc;
                if (!docId) {
                    showNotification('Silinecek öğe bulunamadı!', 'error');
                    return;
                }

                const endpoint = `/delete-cars/${docId}`;

                try {
                    const res = await fetch(endpoint, { method: 'DELETE' });

                    if (!res.ok) {
                        throw new Error(`Silme başarısız: ${res.status} ${res.statusText}`);
                    }

                    const data = await res.json();
                    showNotification('Araç başarıyla silindi!', 'success');
                    setTimeout(() => window.location.reload(), 1500);
                } catch (err) {
                    console.error("Silme işlemi başarısız:", err);
                    showNotification('Silme işlemi sırasında bir hata oluştu!', 'error');
                }
            });
        });

        // Bildirim gösterimi


        // Form gönderim kontrolü
        document.getElementById('carForm').addEventListener('submit', function (e) {
            const fileInput = this.querySelector('input[type="file"]');
            if (fileInput.files.length === 0) {
                e.preventDefault();
                showNotification('Lütfen en az bir fotoğraf yükleyin!', 'error');
                return;
            }

            if (fileInput.files.length > 10) {
                e.preventDefault();
                showNotification('Maksimum 10 fotoğraf yükleyebilirsiniz!', 'error');
                return;
            }

            // Diğer form validasyonları buraya eklenebilir
        });



    </script>
</body>

</html>